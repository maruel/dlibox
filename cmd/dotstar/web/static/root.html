<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>DotStar</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <!--
  https://github.com/DavidDurman/FlexiColorPicker
  -->
  <script type="text/javascript" src="/static/colorpicker.js"></script>
  <!--
  <link rel="stylesheet" href="/src/themes.css">
  -->

  <style>
    #background {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      z-index: -1;
      overflow: hidden;
      color: #dddddd;
      font-size: 128px;
    }

    #picker-wrapper {
        width: 200px;
        height: 200px;
        position: relative;
    }
    #slider-wrapper {
        width: 30px;
        height: 200px;
        position: relative;
    }
    #picker-indicator {
        width: 3px;
        height: 3px;
        position: absolute;
        border: 1px solid white;
    }
    #slider-indicator {
        width: 100%;
        height: 10px;
        position: absolute;
        border: 1px solid black;
    }
/*
    #picker {
      height: 200px;
      width: 200px;
    }
    #slider {
      height: 200px;
      width: 30px;
    }
*/
  </style>
  <script>
    "use strict";

    var patterns = {
      "Aurores": "{\"_type\":\"Aurore\"}",
      "Canne de No√´l": "{\"MovesPerSec\":6,\"Points\":[\"#ff0000ff\",\"#ff0000ff\",\"#ff0000ff\",\"#ff0000ff\",\"#ff0000ff\",\"#ffffffff\",\"#ffffffff\",\"#ffffffff\",\"#ffffffff\",\"#ffffffff\"],\"_type\":\"Repeated\"}",
      "Ciel √©toil√©": "{\"Patterns\":[{\"_type\":\"Aurore\"},{\"Seed\":0,\"Stars\":null,\"_type\":\"NightStars\"},{\"AverageDelay\":0,\"Duration\":0,\"_type\":\"WishingStar\"}],\"Weights\":[1,1,1],\"_type\":\"Mixer\"}",
      "Cycle RGB": "{\"DurationShow\":1000000000,\"DurationTransition\":1000000000,\"Patterns\":[\"#ff0000ff\",\"#00ff00ff\",\"#0000ffff\"],\"Transition\":\"easeinout\",\"_type\":\"Loop\"}",
      "D√©grad√© bleu": "{\"A\":\"#000000ff\",\"B\":\"#0000ffff\",\"_type\":\"Gradient\"}",
      "D√©grad√© rouge": "{\"A\":\"#000000ff\",\"B\":\"#ff0000ff\",\"_type\":\"Gradient\"}",
      "D√©grad√© vert": "{\"A\":\"#000000ff\",\"B\":\"#00ff00ff\",\"_type\":\"Gradient\"}",
      "D√©grad√©": "{\"A\":\"#000000ff\",\"B\":\"#ffffffff\",\"_type\":\"Gradient\"}",
      "K2000": "{\"Background\":\"#000000ff\",\"MovesPerSec\":30,\"Trail\":[\"#ff0000ff\",\"#ff0000ff\",\"#ee0000ff\",\"#dd0000ff\",\"#cc0000ff\",\"#bb0000ff\",\"#aa0000ff\",\"#990000ff\",\"#880000ff\",\"#770000ff\",\"#660000ff\",\"#550000ff\",\"#440000ff\",\"#330000ff\",\"#220000ff\",\"#110000ff\"],\"_type\":\"PingPong\"}",
      "Morning alarm": "{\"Duration\":600000000000,\"In\":\"#00000000\",\"Offset\":1800000000000,\"Out\":{\"Duration\":600000000000,\"In\":\"#ffffffff\",\"Offset\":600000000000,\"Out\":{\"Duration\":600000000000,\"In\":\"#ff7f00ff\",\"Offset\":0,\"Out\":\"#00000000\",\"Transition\":\"linear\",\"_type\":\"Transition\"},\"Transition\":\"linear\",\"_type\":\"Transition\"},\"Transition\":\"linear\",\"_type\":\"Transition\"}",
      "Noir": "\"#00000000\"",
      "Ping pong": "{\"Background\":\"#00000000\",\"MovesPerSec\":30,\"Trail\":[\"#ffffffff\"],\"_type\":\"PingPong\"}",
      "Rainbow cycle": "{\"DurationShow\":1000000000,\"DurationTransition\":10000000000,\"Patterns\":[\"#8b00ffff\",\"#8b00ffff\",\"#8b00ffff\",\"#8b00ffff\",\"#8b00ffff\",\"#8b00ffff\",\"#8b00ffff\"],\"Transition\":\"easeinout\",\"_type\":\"Loop\"}",
      "Rainbow static": "{\"_type\":\"Rainbow\"}",
      "√âtoiles cintillantes": "{\"Seed\":0,\"Stars\":null,\"_type\":\"NightStars\"}",
    };

    function onload() {
      // Set background.
      var text = '';
      for (var i=0; i<50; i++) {
        text += 'üêâüê¢üêáüå¥';
      }
      document.getElementById('background').innerText = text;
      /*
      var oReq = new XMLHttpRequest();
      oReq.onreadystatechange = function() {
        if (oReq.readyState == 4 && oReq.status == 200) {
          loadButtons(JSON.parse(oReq.responseText));
        }
      };
      oReq.open('GET', '/patterns', true);
      oReq.send();
      */
      loadButtons();

      // http://www.daviddurman.com/flexi-color-picker/
      ColorPicker.fixIndicators(
          document.getElementById('slider-indicator'),
          document.getElementById('picker-indicator'));
      ColorPicker(
          document.getElementById('slider'),
          document.getElementById('picker'),
          //document.getElementById('fancy'),
          function(hex, hsv, rgb, pickerCoordinate, sliderCoordinate) {
            ColorPicker.positionIndicators(
                document.getElementById('slider-indicator'),
                document.getElementById('picker-indicator'),
                sliderCoordinate, pickerCoordinate);
            document.body.style.backgroundColor = hex;
            document.getElementById('rgb_r').value = rgb.r;
            document.getElementById('rgb_g').value = rgb.g;
            document.getElementById('rgb_b').value = rgb.b;
            update("pattern=" + btoa('"' + hex + 'FF"'));
          });
    }

    function loadButtons() {
      // Create buttons.
      var styles = [
        "btn-primary", "btn-info", "btn-warning", "btn-danger", "btn-success",
        "btn-default",
      ];
      var j = 0;
      var dst = document.getElementById('boutons');
      for (var k in patterns) {
        var node = document.createElement('button');
        node.type = 'button';
        var v = patterns[k];
        node.id = 'button-' + k;
        node.className = 'btn btn-lg ' + styles[j];
        node.attributes['data-mode'] = btoa(v);
        node.innerHTML = '<img height=5px src="/thumbnail/' + encodeURI(btoa(v)) + '" /> ' + k;
        node.addEventListener('click', function (event) {
          update("pattern=" + encodeURI(this.attributes['data-mode']));
        });
        dst.appendChild(node);
        dst.appendChild(document.createElement('br'));
        j = (j + 1) % styles.length;
      }
    }

    function update(data) {
      var oReq = new XMLHttpRequest();
      oReq.open('post', '/switch', true);
      oReq.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      oReq.send(data);
    }
  </script>
</head>
<body role="document" onload="onload()">
  <div id="background"></div>

  <h1>Luminou</h1>
  <!--
    - Button with thumbnail in it. Use nearestneiborhood resize?
    - Checkbox to add it to the button based loop. Changing takes effect
      immediately.
    - Settings:
      - Nombre de LEDs.
      - Upload
      - Draw
      - Delete
      - Alarm: HH:MM / Jours (DLMMJVS)
      - Wake up: 20 / 40 min
      - Bonne nuit: 20 min.
  -->
  <div class="page-header"><h2>Choix d'animations</h2></div>
  <div id="boutons"></div>
  <div class="page-header"><h2>Couleur manuelle</h2></div>

  <!--
  <div id="picker"></div> <div id="slider"></div>
  -->
  <div style="display:inline">
    <div id="picker-wrapper">
      <div id="picker"></div>
      <div id="picker-indicator"></div>
    </div>
    <div id="slider-wrapper">
      <div id="slider"></div>
      <div id="slider-indicator"></div>
    </div>
    <!--
    <div id="fancy" class="cp cp-fancy"></div>
    -->

    <span id="rgb_css"></span>
    <label>R:</label>
    <input id="rgb_r" type="number" value="" />
    <label>G:</label>
    <input id="rgb_g" type="number" value="" />
    <label>B:</label>
    <input id="rgb_b" type="number" value="" />
  </div>
  <br>
  <h2>Configuration</h2>
  TODO(maruel): Add alarms here.
  <p>

</body>
</html>
